{% extends "base.html" %}

{% block extra_head %}
<script language="javascript" src="{{ STATIC_URL }}js/jquery-1.6.3.min.js"></script>
<script language="javascript" src="{{ STATIC_URL }}js/jquery-ui-1.8.16.custom.min.js"></script>
<script language="javascript" src="{{ STATIC_URL }}js/jquery.pageless.min.js"></script>
<script type="text/javascript">
    $(function() {
        $('#results').pageless({
            totalPages: {{ total_paginas }},
            url: './',
            params : {
                q: "{{ q }}"
            },
            loaderMsg: 'Cargando más resultados',
            loaderImage: '{{ STATIC_URL }}images/busy.gif'
        });
        $('#q').autocomplete({
            source: function(request, response) {
                $.ajax({
                    url: "./",
                    dataType: "json",
                    data: {
                        q: request.term,
                        json: 1,
                        per_page: 10,
                    },
                    success: function(data) {
                        response($.map(data, function(item) {
                            var results = {};
                            what = request.term.replace(' ', '|');
                            pattern = new RegExp('(' + what + ')','gi');
                            replaceWith = '<strong>$1</strong>';
                            return {
                                title: item.title.replace(pattern, replaceWith),
                                creator: item.creator.replace(pattern, replaceWith),
                                niu: item.niu.replace(pattern, replaceWith),
                                value: item.url.replace(pattern, replaceWith),
                            };
                        }));
                    }
                });
            },
            minLength: 3,
            select: function( event, ui ) {
                window.location.href = ui.item.value;
                return false;
            },
            focus: function( event, ui ) {
                return false;
            }
        })
        .data("autocomplete")._renderItem = function(ul, item) {
            return $("<li></li>")
                .data("item.autocomplete", item)
                .append( "<a>" + item.title + "<br><small>" + item.creator +
                    " (" + item.niu + ") " + "</small></a>" )
                .appendTo( ul );
        };
    })
</script>
{% endblock %}

{% block content_title %}Trabajos que esperan ser
{% if estado == 'solicitado' %}
autorizados
{% endif %}
{% if estado == 'autorizado' %}
calificados
{% endif %}
{% if estado == 'calificado' %}
archivados
{% endif %}
{% endblock %}

{% block content %}
{% if proyectos %}
<div class="item">
<form action="." enctype="multipart/form-data" method="GET" class="buscar">
    <input id="q" type="text" name="q" {% if q %}value="{{ q }}"{% endif %} title="Buscar" />
    <input type="submit" class="button" value="Buscar" />
</form>
</div>

<div class="item">
<p>Hay un total de {{ total_proyectos }} trabajos pendientes de ser revisados.</p>
<table id="results" class="listado">
    <tr>
        <th>Alumno</th>
        <th>Título</th>
    </tr>
{% include "lista_proyecto_partial.html" %}
</table>
</div>
{% else %}
<div class="item">
    <p>No hay proyectos pendientes de ser revisados.</p>
</div>
{% endif %}
{% endblock %}


